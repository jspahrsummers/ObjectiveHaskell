#!/bin/bash
#
# Generates an xcconfig file that sets up proper header and library search paths
# for an ObjectiveHaskell application.
#
# The first argument is the location at which to generate the xcconfig. The
# second argument, if any, is an xcconfig to base the generated file on
# (relative to the output file's path).

set -o errexit

SCRIPT_DIR=$(dirname "$0")
. "$SCRIPT_DIR/ghcdef"

OUTPUT_FILE="$1"

echo -e "// This file is automatically generated by ObjectiveHaskell's genconfig script.\n// Please do not commit it!\n" > "$OUTPUT_FILE"

if [ -n "$2" ]
then
    echo -e "#include \"$2\"\n" >> "$OUTPUT_FILE"
fi

GHC_LIBDIR=`"$GHC" --print-libdir`

echo -e "HEADER_SEARCH_PATHS = $GHC_LIBDIR/include/" >> "$OUTPUT_FILE"
echo -e "LIBRARY_SEARCH_PATHS = \$DERIVED_FILE_DIR $GHC_LIBDIR/**" >> "$OUTPUT_FILE"
echo -e "OTHER_LDFLAGS = -ObjC -lhsbuild" >> "$OUTPUT_FILE"
